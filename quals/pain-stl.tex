\documentclass{beamer}
\usetheme{CambridgeUS}
\usecolortheme{dolphin}
\usepackage[utf8]{inputenc}
\usepackage{dirtytalk,amsmath,tikz,mathtools,amsmath, empheq}
\usepackage{stackengine}
\usepackage{stmaryrd}
\usepackage{graphicx}
\usepackage{resizegather}
\usetikzlibrary{automata, positioning}
\graphicspath{ {./images/} }
\tikzset{->, initial text=$$}
\DeclareMathAlphabet{\mathpzc}{OT1}{pzc}{m}{it}

%Information to be included in the title page:
\title[Parameter Invariant Monitoring for STL]{Parameter Invariant Monitoring for Signal Temporal Logic}
\subtitle{Nima Roohi, Ramneet Kaur, James Weimer, Oleg Sokolsky, Insup Lee}
\author{Manasvi Saxena}

%\setbeameroption{hide notes} % Only slides
%\setbeameroption{show only notes} % Only notes
%\setbeameroption{show notes on second screen=right} % Both
%\setbeamertemplate{note page}{\pagecolor{yellow!5}\insertnote}\usepackage{palatino}
\setbeamerfont{caption}{size=\scriptsize}
\date{}


\newcommand{\always}[1]{\square_{#1}}
\newcommand{\eventually}[1]{\lozenge_{#1}}

\newcommand{\typeTime}{\mathbb{R}_{\geq 0}}
\newcommand{\typeReal}{\mathbb{R}}
\newcommand{\typeNat}{\mathbb{N}}
\newcommand{\typeProb}{\mathbb{P}}

\newcommand{\dom}{\text{dom}}


\newcommand{\until}{\mathcal{U}}
\newcommand{\release}{\mathcal{R}}
\newcommand{\interval}{\mathcal{I}}
\newcommand{\observe}{\mathcal{O}}
\newcommand{\K}{\mathcal{K}}
\newcommand{\A}{\mathcal{A}}

% text versions
\newcommand{\Z}{\text{Z}}
\newcommand{\f}{\text{f}}
\newcommand{\varT}{\text{t}}

%satisfaction
\newcommand{\discrete}{\raisebox{-0.1ex}{\scalebox{0.25}{\textrm{DSC}}}}
\newcommand{\cont}{\raisebox{-0.1ex}{\scalebox{0.25}{\textrm{CNT}}}}
\newcommand{\discreteSatisfy}{\ \stackMath\stackunder[0pt]{\vDash}{\hspace*{0.3em}\discrete}\ }
\newcommand{\contSatisfy}{\ \stackMath\stackunder[0pt]{\vDash}{\hspace*{0.3em}\cont}\ }
\newcommand{\robustAssign}{\; := \;}
\begin{document}

\frame{\titlepage}

\section{Introduction}
\subsection{Motivation}

\begin{frame}
    \frametitle{Motivations}

    Challenges in monitoring Real Time Systems -
    \begin{itemize}
        \item \textit{Partially Observable} States.
        \item \textit{Partially Observable} Traces.
        \item \textit{High Computation} Cost.
    \end{itemize}

    \pause

    Extends Parameter Invariant (PAIN) tests to -
    \begin{itemize}
        \item STL to support continuous systems
        \item Efficiently monitor STL online.
    \end{itemize}

\end{frame}

\begin{frame}
    \frametitle{Example}
    \framesubtitle{Monitoring a Diabetic Patient}

    STL formula, \say{If patient has a meal (M), then (s)he
    either recieved bolus $t_1$ units ago, or will recieve one in $t_2$ units}
        $$ \always{ [ t_1, \infty )}
    \left( \left (M > c_1 \right ) \to \eventually{\left(-t_1, t_2 \right)}
    \left( B > c_2 \right ) \right)$$.
    \pause
    \begin{itemize}
        \item \textit{State} variables not directly Observable.
        \item \textit{Output} variables affected by sensor and environment noise.
        \item Models are \textit{parametric}. Estimating (\textit{nuissance}) parameters is not
            feasible.
    \end{itemize}
\end{frame}
\begin{frame}
    \frametitle{Example}
    \framesubtitle{Monitoring a Diabetic Patient}

    STL formula, \say{If patient has a meal (M), then (s)he
    either recieved bolus $t_1$ units ago, or will recieve one in $t_2$ units}
    \begin{itemize}
        \item B (Bolus) is observable, but M (Meal) is not. Furthermore, B
            can be affected by noise.
        \pause
        \item Avoid relying on exact models of the system.
        \item Rely on \textit{probabilistic beliefs} about
            system state at a given point in time.
        \pause
        \item Furthermore, use \textit{maximally invariant} statistics
            to derive \textit{probabilistic beliefs}
    \end{itemize}
\end{frame}

\section{Preliminaries}
\subsection{Signal Temporal Logic (STL)}
\begin{frame}
    \frametitle{Signal Temporal Logic}
    \begin{block}{Signals}
        Given a finite set of variables $\Z$, signal
        $f : \typeTime \to \typeReal^{\Z}$ is a mapping
        from a point in \textit{time} to a \textit{valuation} of $\Z$.
    \end{block}
    \pause
    \begin{block}{Formulas over Signals}
        \begin{itemize}
            \item An formula $\theta : \typeReal^{\Z} \to \typeReal$
                  maps a \textit{valuation} to a real value.
            \item Function $\theta \circ f : \typeTime \to \typeReal$
                  maps points in time to values defined by $\theta$.
            \item At time $t \in \typeTime$, signal $f$ is \textit{true}
                w.r.t. $\theta$ whenever $\theta(f(t)) > 0 $.
                Conversely, $f$ is \textit{false} w.r.t $\theta$
                w.r.t. $\theta$ whenever $\theta(f(t)) < 0 $.
            \item Whenever, $\theta(f (t)) = 0$, value of $f$
                is \textit{unknown} on $\theta$ at time $t$.
            \item $\theta(f(t))$, is the \textit{robustness degree}.
                Larger \textit{robustness degree} values signify
                greater \textit{belief} about signal's adherence to $\theta$.
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Signal Temporal Logic}
    \begin{block}{Syntax}
        \begin{itemize}
            \item $ \varphi ::= \top \;|\; \bot \;|\; \Theta \;|\; \neg \Theta
                \; | \; \varphi \wedge \varphi \;|\; \varphi\ \until_{\interval_{\geq 0}}\ \varphi
                \; | \; \varphi \release_{\interval_{\geq 0}} \varphi $
            \item $\eventually{\interval} \varphi \equiv \top\ \until_{\interval}\ \varphi$
            \item $\always{\interval} \varphi \equiv \bot \release_{\interval} \varphi$
            \item Law of Excluded Middle not assumed. Robustness 0 means
                signal neither satisfies nor not satisfies a formula.
                It is possible for $\varphi \vee \neg \varphi$ to not
                be true.
            \item Law of non contradiction still holds. It is not possible
                for both $\varphi$ and $\neg \varphi$ to be true.
        \end{itemize}
    \end{block}
\end{frame}

\begin{frame}
    \frametitle{Semantics}
    \begin{block}{Continuous Semantics}
        Given signal $f$ and a point in time $r : \typeTime$,
        Continuous time STL semantics are given inductively as -
        \begin{align*}
              f, r &\contSatisfy \top       \robustAssign \infty &
              f, r &\contSatisfy \bot       \robustAssign -\infty \\
              f, r &\contSatisfy \theta     \robustAssign \theta(f(r)) &
              f, r &\contSatisfy \neg\theta \robustAssign -\theta(f(r)) \\
              f, r &\contSatisfy \theta     \robustAssign \theta(f(r)) &
              f, r &\contSatisfy \neg\theta \robustAssign -\theta(f(r)) \\
        \end{align*}
        \vspace{-1.6cm}
        \begin{align*}
            f, r \contSatisfy \phi \vee \psi  \robustAssign  f, r \contSatisfy \phi \; \sqcup \; f,r \contSatisfy \psi \\
            f, r \contSatisfy \phi \wedge \psi  \robustAssign  f, r \contSatisfy \phi \; \sqcap \; f,r \contSatisfy \psi \\
        \end{align*}
    \end{block}
    where $\sqcup$ and $\sqcap$ represent $\text{sup}$, $\text{inf}$ respectively.
\end{frame}

\begin{frame}
    \frametitle{Semantics}
    \begin{block}{Continuous Semantics}
        Given signal $f$ and point in time $r : \typeTime$,
        Continuous time STL semantics are given inductively as -
        \begin{align*}
            f, r \contSatisfy \phi\ \until_{\interval}\ \psi
           \robustAssign \bigsqcup_{t: r+\interval}\left( f, t \contSatisfy \psi
           \sqcap \bigsqcap_{r \leq t' \leq t} \left( f, t' \contSatisfy \psi
            \right ) \right) \\
            f, r \contSatisfy \phi\ \release_{\interval}\ \psi
           \robustAssign \bigsqcap_{t: r+\interval}\left( f, t \contSatisfy \psi
           \sqcup \bigsqcup_{r \leq t' \leq t} \left( f, t' \contSatisfy \psi
            \right ) \right)
        \end{align*}
    \end{block}
    where $\sqcup$ and $\sqcap$ represent $\text{sup}$, $\text{inf}$ respectively.
\end{frame}

\begin{frame}
    \frametitle{Semantics}
    \begin{block}{Discrete Semantics}
        Given signal $f$ and sampling function $\tau : \typeNat
        \to \typeTime$, discrete time semantics for $g := f \circ \tau : \typeNat
        \to  \typeReal^{\Z}$ at step $n:\typeNat$ are given inductively as -
        \begin{align*}
              g, n &\discreteSatisfy \top       \robustAssign \infty &
              g, n &\discreteSatisfy \bot       \robustAssign -\infty \\
              g, n &\discreteSatisfy \theta     \robustAssign \theta(g(n)) &
              g, n &\discreteSatisfy \neg\theta \robustAssign -\theta(g(n)) \\
              g, n &\discreteSatisfy \theta     \robustAssign \theta(g(n)) &
              g, n &\discreteSatisfy \neg\theta \robustAssign -\theta(g(n)) \\
        \end{align*}
        \vspace{-1.6cm}
        \begin{align*}
            g, n \discreteSatisfy \phi \vee \psi  \robustAssign  g, n \discreteSatisfy \phi \; \sqcup \; g, n\discreteSatisfy \psi \\
            g, n \discreteSatisfy \phi \wedge \psi  \robustAssign  g, n \discreteSatisfy \phi \; \sqcap \; g, n \discreteSatisfy \psi \\
        \end{align*}
    \end{block}
    where $\sqcup$ and $\sqcap$ represent $\text{sup}$, $\text{inf}$ respectively.
\end{frame}

\begin{frame}
    \frametitle{Semantics}
    \begin{block}{Discrete Semantics}
        Given signal $f$ and sampling function $\tau : \typeNat
        \to \typeTime$, discrete time semantics for $g := f \circ \tau : \typeNat
        \to  \typeReal^{\Z}$ at step $n:\typeNat$ are given inductively as -
        \begin{align*}
            g, n \contSatisfy \phi\ \until_{\interval}\ \psi
            \robustAssign \bigsqcup_{i: \tau^{-1}(\tau((n) +\interval)}\left( g, i \contSatisfy \psi
           \sqcap \bigsqcap_{n \leq j \leq i} \left( g, j \contSatisfy \psi
            \right ) \right) \\
            g, n \contSatisfy \phi\ \release_{\interval}\ \psi
           \robustAssign \bigsqcap_{i: \tau^{-1}(\tau((n) +\interval)} \left( g, i \contSatisfy \psi
           \sqcup \bigsqcup_{n \leq j \leq i} \left( g, n' \contSatisfy \psi
            \right ) \right)
        \end{align*}
    \end{block}
    where $\sqcup$ and $\sqcap$ represent $\text{sup}$, $\text{inf}$ respectively.
\end{frame}

\begin{frame}
    \frametitle{Strengthening STL Formulas}
    For STL formula $\varphi$, and $\delta : \typeTime$,
    $\varphi^{\delta}$ (strengthening) is defined as -
    \begin{itemize}
        \item $\bot^{\delta} := \bot \;\;\;\; \top^{\delta} := \top   \;\;\;\; p^{\delta} := p
            \;\;\;\; (\neg p)^{\delta} := \neg p$
        \item $(\varphi \vee \psi)^{\delta} := \varphi^{\delta} \vee \psi^{\delta}
            \;\;\;\; (\varphi \wedge \psi)^{\delta} := \varphi^{\delta} \wedge \psi^{\delta}$
        \item $(\varphi\ \until_{\interval}\ \psi)^{\delta} := \varphi^{\delta} \
            \until_{\left (\underline{\interval} + \delta, \overline{\interval}
            - \delta \right)}\ \psi^{\delta}$
        \item $(\varphi\ \release_{\interval}\ \psi)^{\delta} := \varphi^{\delta} \
            \release_{\left ((\underline{\interval} - \delta)^{+}, \overline{\interval}
            + \delta \right)}\ \psi^{\delta}$
    \end{itemize}
    Intuitvely, strengthening slightly shortens (lengthens) intervals
    for $\until (\release) $. Along with conditions about the signal
    and sampling function, strengthening allows using discrete-time
    STL to reason about continuous-time STL.
\end{frame}

\begin{frame}
    \frametitle{Discrete to Continuous Time STL}
    Given signal $f$, formula $\varphi$, \textit{strictly increasing} sampling function
    $\tau$, where $\Delta \tau = \sqcup_{n : \typeNat}(\tau(n+1) - \tau(n))$,
    and $\delta : \typeTime$, where
    \begin{itemize}
        \item $\exists \lambda:\typeReal_{+}$ such
            that for $\theta : \Theta$, $\theta \circ f$ is
            $\lambda$-\textit{Lipschitz} continuous.
        \item $\delta$ is sufficiently large - $\lambda \Delta\tau < \delta$.
        \item Sampling is sufficient - $\Delta\tau < \frac{1}{3}
            \text{min}_{\interval:\interval_{\varphi}}(\overline{\interval} -
            \underline{\interval})$, where $\interval_{\varphi}$ are intervals
            in temporal operators of $\varphi$.
        \item Sampling started early - $\tau(0) < \Delta\tau$
    \end{itemize}
    guarantees the following hold -
    \begin{itemize}
        \item $f \circ \tau\ \discreteSatisfy\ \varphi^{\Delta\tau} \implies f
        \contSatisfy \varphi > 0 $.
        \item $f \circ \tau\ \discreteSatisfy\ \neg\varphi^{\Delta\tau} \implies f
        \contSatisfy \varphi < 0 $.
    \end{itemize}
    Instead of proving $f \contSatisfy \varphi > 0 $, prove
    $f, \tau \discreteSatisfy \varphi^{\Delta\tau} > \delta$.
\end{frame}

\subsection{Parameter Invariant Test Statisitc}

\begin{frame}
    \frametitle{Partially Observable States}
    Say we have test functions $\Theta$, signal $f$
    and sampling time $\tau$. For $\theta : \Theta$, $\theta \circ f$ cannot
    be directly observed.
    \begin{itemize}
        \item $\observe(\theta, f, t) = F\mu + \theta^+(f(t))G_0\rho_0
                + \theta^{-}(f(t))G_1\rho_1 + \sigma n$
        \item $Y$ is a set of \textit{observable} variables.
        \item $\mu : \dom(\mu) \to \typeReal, \rho_0 : \dom(\rho_i) \to
            \typeReal$ for $i \in \{0, 1\}$ are \textit{unknown nuissance} vectors.
        \item $F : \typeReal^{Y \times \dom(\mu)}$,
            $G_i : \typeReal^{Y \times \dom(\rho_i)}$ for $i \in \{0, 1\}$ are
            \textit{known signal matrices}.
        \item $\sigma$ is unkown noise multiplier, $n$ is random noise.
    \end{itemize}
\end{frame}

\subsection{Parameter Invariant Test Statisitc}

\begin{frame}
    \frametitle{Partially Observable States}
    \begin{itemize}
        \item It is assumed that for each \textit{test function}
            $\theta, \theta' \in \Theta$, $\theta \neq \theta' \implies
            Y_{\theta} \cup Y_{\theta'} = \emptyset$. In other words,
            different test functions use \textit{disjoint observable variables}.
        \item $\observe(f, t)$ - random variable corresponding to
            the observation of signal $f$ at time $t$ is \textit{uniquely determined}
            by $\observe(\theta, f, t)$ for each $\theta \in \Theta$.
    \end{itemize}
\end{frame}

\begin{frame}
    \frametitle{Invariance to Transformations}
    \begin{itemize}
        \item Given $\Omega$, the sampling space
            of a probabily-space and $\K \subseteq \Omega \to \Omega$
            a group of transformations.
        \item Let $\eta : \Omega \to \Omega'$ be a statistic.
        \item $\eta$ is said to be \textit{invariant} to
            group of transformations $\K$ iff
            $$ \forall \omega : \Omega, k : \K . \eta(\omega) = \eta(k(\omega))$$
        \item $\eta$ is said to be \textit{maximally invariant} to
            group of transformations $\K$ iff
            $$ \forall \omega, \omega' : \Omega . \eta(\omega) = \eta(\omega')
            \implies (\exists k : \K . \omega = k(\omega'))$$
    \end{itemize}
\end{frame}

\section{Parameter Invariance Monitoring For STL}
\subsection{Parameter Invariant Estimates}


\begin{frame}
\frametitle{Parameter Invariant Estimation of Atomic Propositions}

\begin{block}{Using Parameter Invariant Procedures for Estimation}
    Given $\Omega_{f, \tau}: \typeNat \to \typeReal^{X}$, the space
    of all observations, $x: \Omega_{f, \tau}$,  test function $\theta \in \Theta$,
    error and indifference bounds $\alpha', \delta' :\typeReal^{+}$.

    One can find a algorithm $\A(x, \tau, \theta, \alpha', \delta')$ such that -
    \begin{itemize}
        \item $\A$ is \textit{terminating} and returns value $r:\typeReal$.
        \item $\typeProb({\mid (\theta \circ f \circ \tau)(0) - r \mid > \delta'}) < \alpha'$
        \item $r$ is an estimate for the \textit{robustness degree} of the
            signal $f$ on $\theta$
        \item The \textit{Probability} that $r$ (i.e. the \textit{robustness degree estimate}
            returned by $\A$) is more than $\delta'$ away from the real value of
            $f \circ \tau \discreteSatisfy \theta$ is less than $\alpha'$.
    \end{itemize}

\end{block}
\end{frame}
\end{document}



